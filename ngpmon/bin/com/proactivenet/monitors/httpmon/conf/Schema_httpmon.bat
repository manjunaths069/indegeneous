REM Check if its a Clean or an Upgrade Installation

sqli -c "SELECT * FROM SYSTABLE B WHERE B.TABLE_NAME = 'WEBRESP_STATS';" > out.txt

if %errorlevel% == 101 (

REM Clean Installation for Monitor = Web URL
REM Schema & PruneCntl Statements for Monitor = Web URL ,moTypeId = 20031

echo Creating tables WEBRESP_STATS, WEBRESP_RT, WEBRESP_BL
echo Creating Prune Control entries for WEBRESP_STATS  AND  entries for WEBRESP_RT
sqli "CREATE TABLE WEBRESP_STATS (ITEMID int,TIMERECORDED int,TOTRESPTIME int,AVAILABILITY int,INTRESPTIME int,EXTRESPTIME int,TOTCONNTIME int,INTCONNTIME int,EXTCONNTIME int,TOTOBJNTFOUND int,INTOBJNTFOUND int,EXTOBJNOTFOUND int,TOTINVLINKS int,INTINVLINKS int,EXTINVLINKS int,FIRSTBYTETIME int,DNSTIME int,CHECKSUM int,BYTES int,PRIMARY KEY ("ITEMID", "TIMERECORDED") WITH HASH SIZE 10);"

REM If the STATS table creation failed exit with errorcode
if %errorlevel% == 1 (
    exit /b 117
)

sqli "create        index WEBRESP_STATS_N3 on WEBRESP_STATS (TIMERECORDED);"

sqli "CREATE TABLE WEBRESP_RT (ITEMID int, FROMTIME int, TOTIME int, TOTRESPTIME_HIGH int, TOTRESPTIME_AVG  int, TOTRESPTIME_LOW  int, AVAILABILITY_HIGH int, AVAILABILITY_AVG  int, AVAILABILITY_LOW  int, INTRESPTIME_HIGH int, INTRESPTIME_AVG  int, INTRESPTIME_LOW  int, EXTRESPTIME_HIGH int, EXTRESPTIME_AVG  int, EXTRESPTIME_LOW  int, TOTCONNTIME_HIGH int, TOTCONNTIME_AVG  int, TOTCONNTIME_LOW  int, INTCONNTIME_HIGH int, INTCONNTIME_AVG  int, INTCONNTIME_LOW  int, EXTCONNTIME_HIGH int, EXTCONNTIME_AVG  int, EXTCONNTIME_LOW  int, TOTOBJNTFOUND_HIGH int, TOTOBJNTFOUND_AVG  int, TOTOBJNTFOUND_LOW  int, INTOBJNTFOUND_HIGH int, INTOBJNTFOUND_AVG  int, INTOBJNTFOUND_LOW  int, EXTOBJNOTFOUND_HIGH int, EXTOBJNOTFOUND_AVG  int, EXTOBJNOTFOUND_LOW  int, TOTINVLINKS_HIGH int, TOTINVLINKS_AVG  int, TOTINVLINKS_LOW  int, INTINVLINKS_HIGH int, INTINVLINKS_AVG  int, INTINVLINKS_LOW  int, EXTINVLINKS_HIGH int, EXTINVLINKS_AVG  int, EXTINVLINKS_LOW  int, FIRSTBYTETIME_HIGH int, FIRSTBYTETIME_AVG  int, FIRSTBYTETIME_LOW  int, DNSTIME_HIGH int, DNSTIME_AVG  int, DNSTIME_LOW  int, CHECKSUM_HIGH int, CHECKSUM_AVG  int, CHECKSUM_LOW  int, BYTES_HIGH int, BYTES_AVG  int, BYTES_LOW  int, NUMPOINTS int, NUMSECS   int, PRIMARY KEY ("ITEMID", "FROMTIME") WITH HASH SIZE 10);"

sqli "create index WEBRESP_RT_N3 on WEBRESP_RT (FROMTIME,TOTIME);"

sqli "CREATE TABLE WEBRESP_BL (ITEMID   int,TIMESLOT int,TOTRESPTIME_HIGH int,TOTRESPTIME_AVG  int,TOTRESPTIME_LOW  int,AVAILABILITY_HIGH int,AVAILABILITY_AVG  int,AVAILABILITY_LOW  int,INTRESPTIME_HIGH int,INTRESPTIME_AVG  int,INTRESPTIME_LOW  int,EXTRESPTIME_HIGH int,EXTRESPTIME_AVG  int,EXTRESPTIME_LOW  int,TOTCONNTIME_HIGH int,TOTCONNTIME_AVG  int,TOTCONNTIME_LOW  int,INTCONNTIME_HIGH int,INTCONNTIME_AVG  int,INTCONNTIME_LOW  int,EXTCONNTIME_HIGH int,EXTCONNTIME_AVG  int,EXTCONNTIME_LOW  int,TOTOBJNTFOUND_HIGH int,TOTOBJNTFOUND_AVG  int,TOTOBJNTFOUND_LOW  int,INTOBJNTFOUND_HIGH int,INTOBJNTFOUND_AVG  int,INTOBJNTFOUND_LOW  int,EXTOBJNOTFOUND_HIGH int,EXTOBJNOTFOUND_AVG  int,EXTOBJNOTFOUND_LOW  int,TOTINVLINKS_HIGH int,TOTINVLINKS_AVG  int,TOTINVLINKS_LOW  int,INTINVLINKS_HIGH int,INTINVLINKS_AVG  int,INTINVLINKS_LOW  int,EXTINVLINKS_HIGH int,EXTINVLINKS_AVG  int,EXTINVLINKS_LOW  int,FIRSTBYTETIME_HIGH int,FIRSTBYTETIME_AVG  int,FIRSTBYTETIME_LOW  int,DNSTIME_HIGH int,DNSTIME_AVG  int,DNSTIME_LOW  int,CHECKSUM_HIGH int,CHECKSUM_AVG  int,CHECKSUM_LOW  int,BYTES_HIGH int,BYTES_AVG  int,BYTES_LOW  int,NUMPOINTS int,NUMWEEKS int,PRIMARY KEY ("ITEMID", "TIMESLOT") WITH HASH SIZE 10);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('WEBRESP_STATS', 'TIMERECORDED', 24);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('WEBRESP_RT', 'FROMTIME', 2160);"

) else (

REM Upgrade Installation for Monitor = Web URL

REM sqli -c "
REM SELECT * FROM SYSCOLUMN A, SYSTABLE B WHERE A.TABLE_ID = B.TABLE_ID AND B.TABLE_NAME = 'TABLENAME' AND A.COLUMN_NAME = 'COLUMNNAME';
REM "
REM if %errorlevel% == 101 (

REM alter table add column statement here
echo Upgrade installation

REM )

)
