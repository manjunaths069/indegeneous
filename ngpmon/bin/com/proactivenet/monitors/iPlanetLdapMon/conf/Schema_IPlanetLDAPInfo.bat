REM Check if its a Clean or an Upgrade Installation

sqli -c "SELECT * FROM SYSTABLE B WHERE B.TABLE_NAME = 'IPLDAP_STATS';" > out.txt

if %errorlevel% == 101 (

REM Clean Installation for Monitor = SunOne Directory Server
REM Schema & PruneCntl Statements for Monitor = SunOne Directory Server ,moTypeId = 40005

echo Creating tables IPLDAP_STATS, IPLDAP_RT, IPLDAP_BL
echo Creating Prune Control entries for IPLDAP_STATS  AND  entries for IPLDAP_RT
sqli "CREATE TABLE IPLDAP_STATS (ITEMID int,TIMERECORDED int,AVAILABILITY int,RESPTIME int,TCONNECTS int,OCONNECTS int,ACTTHRADS int,OPSINIT int,OPESCOMPLT int,REDWAITRS int,DTABLESIZE int,ENTRSENT int,BYTSENT int,PRIMARY KEY ("ITEMID", "TIMERECORDED") WITH HASH SIZE 10);"

REM If the STATS table creation failed exit with errorcode
if %errorlevel% == 1 (
    exit /b 117
)

sqli "create        index IPLDAP_STATS_N3 on IPLDAP_STATS (TIMERECORDED);"

sqli "CREATE TABLE IPLDAP_RT (ITEMID int, FROMTIME int, TOTIME int, AVAILABILITY_HIGH int, AVAILABILITY_AVG  int, AVAILABILITY_LOW  int, RESPTIME_HIGH int, RESPTIME_AVG  int, RESPTIME_LOW  int, TCONNECTS_HIGH int, TCONNECTS_AVG  int, TCONNECTS_LOW  int, OCONNECTS_HIGH int, OCONNECTS_AVG  int, OCONNECTS_LOW  int, ACTTHRADS_HIGH int, ACTTHRADS_AVG  int, ACTTHRADS_LOW  int, OPSINIT_HIGH int, OPSINIT_AVG  int, OPSINIT_LOW  int, OPESCOMPLT_HIGH int, OPESCOMPLT_AVG  int, OPESCOMPLT_LOW  int, REDWAITRS_HIGH int, REDWAITRS_AVG  int, REDWAITRS_LOW  int, DTABLESIZE_HIGH int, DTABLESIZE_AVG  int, DTABLESIZE_LOW  int, ENTRSENT_HIGH int, ENTRSENT_AVG  int, ENTRSENT_LOW  int, BYTSENT_HIGH int, BYTSENT_AVG  int, BYTSENT_LOW  int, NUMPOINTS int, NUMSECS   int, PRIMARY KEY ("ITEMID", "FROMTIME") WITH HASH SIZE 10);"

sqli "create index IPLDAP_RT_N3 on IPLDAP_RT (FROMTIME,TOTIME);"

sqli "CREATE TABLE IPLDAP_BL (ITEMID   int,TIMESLOT int,AVAILABILITY_HIGH int,AVAILABILITY_AVG  int,AVAILABILITY_LOW  int,RESPTIME_HIGH int,RESPTIME_AVG  int,RESPTIME_LOW  int,TCONNECTS_HIGH int,TCONNECTS_AVG  int,TCONNECTS_LOW  int,OCONNECTS_HIGH int,OCONNECTS_AVG  int,OCONNECTS_LOW  int,ACTTHRADS_HIGH int,ACTTHRADS_AVG  int,ACTTHRADS_LOW  int,OPSINIT_HIGH int,OPSINIT_AVG  int,OPSINIT_LOW  int,OPESCOMPLT_HIGH int,OPESCOMPLT_AVG  int,OPESCOMPLT_LOW  int,REDWAITRS_HIGH int,REDWAITRS_AVG  int,REDWAITRS_LOW  int,DTABLESIZE_HIGH int,DTABLESIZE_AVG  int,DTABLESIZE_LOW  int,ENTRSENT_HIGH int,ENTRSENT_AVG  int,ENTRSENT_LOW  int,BYTSENT_HIGH int,BYTSENT_AVG  int,BYTSENT_LOW  int,NUMPOINTS int,NUMWEEKS int,PRIMARY KEY ("ITEMID", "TIMESLOT") WITH HASH SIZE 10);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('IPLDAP_STATS', 'TIMERECORDED', 24);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('IPLDAP_RT', 'FROMTIME', 2160);"

) else (

REM Upgrade Installation for Monitor = SunOne Directory Server

REM sqli -c "
REM SELECT * FROM SYSCOLUMN A, SYSTABLE B WHERE A.TABLE_ID = B.TABLE_ID AND B.TABLE_NAME = 'TABLENAME' AND A.COLUMN_NAME = 'COLUMNNAME';
REM "
REM if %errorlevel% == 101 (

REM alter table add column statement here
echo Upgrade installation

REM )

)
