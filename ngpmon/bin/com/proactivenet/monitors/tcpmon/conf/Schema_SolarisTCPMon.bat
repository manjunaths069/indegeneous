REM Check if its a Clean or an Upgrade Installation

sqli -c "SELECT * FROM SYSTABLE B WHERE B.TABLE_NAME = 'SOLTCP_STATS';" > out.txt

if %errorlevel% == 101 (

REM Clean Installation for Monitor = Solaris TCP
REM Schema & PruneCntl Statements for Monitor = Solaris TCP ,moTypeId = 28701

echo Creating tables SOLTCP_STATS, SOLTCP_RT, SOLTCP_BL
echo Creating Prune Control entries for SOLTCP_STATS  AND  entries for SOLTCP_RT
sqli "CREATE TABLE SOLTCP_STATS (ITEMID int,TIMERECORDED int,AVTIVEOPEN int,PASSIVEOPEN int,CURRESTAB int,LISTENDROP int,HALFOPENDROP int,LISTENDROPQ0 int,INSEGS int,INORDERSEGS int,UNORDERSEGS int,DUPSEGS int,PARTDUPSEGS int,INBYTES int,INORDERBYTES int,UNORDERBYTES int,DUPBYTES int,PARTDUPBYTES int,OUTSEGS int,OUTDATASEGS int,RETRANSSEGS int,OUTBYTES int,OUTDATABYTES int,RETRANSBYTES int,PRIMARY KEY ("ITEMID", "TIMERECORDED") WITH HASH SIZE 10);"

REM If the STATS table creation failed exit with errorcode
if %errorlevel% == 1 (
    exit /b 117
)

sqli "create        index SOLTCP_STATS_N3 on SOLTCP_STATS (TIMERECORDED);"

sqli "CREATE TABLE SOLTCP_RT (ITEMID int, FROMTIME int, TOTIME int, AVTIVEOPEN_HIGH int, AVTIVEOPEN_AVG  int, AVTIVEOPEN_LOW  int, PASSIVEOPEN_HIGH int, PASSIVEOPEN_AVG  int, PASSIVEOPEN_LOW  int, CURRESTAB_HIGH int, CURRESTAB_AVG  int, CURRESTAB_LOW  int, LISTENDROP_HIGH int, LISTENDROP_AVG  int, LISTENDROP_LOW  int, HALFOPENDROP_HIGH int, HALFOPENDROP_AVG  int, HALFOPENDROP_LOW  int, LISTENDROPQ0_HIGH int, LISTENDROPQ0_AVG  int, LISTENDROPQ0_LOW  int, INSEGS_HIGH int, INSEGS_AVG  int, INSEGS_LOW  int, INORDERSEGS_HIGH int, INORDERSEGS_AVG  int, INORDERSEGS_LOW  int, UNORDERSEGS_HIGH int, UNORDERSEGS_AVG  int, UNORDERSEGS_LOW  int, DUPSEGS_HIGH int, DUPSEGS_AVG  int, DUPSEGS_LOW  int, PARTDUPSEGS_HIGH int, PARTDUPSEGS_AVG  int, PARTDUPSEGS_LOW  int, INBYTES_HIGH int, INBYTES_AVG  int, INBYTES_LOW  int, INORDERBYTES_HIGH int, INORDERBYTES_AVG  int, INORDERBYTES_LOW  int, UNORDERBYTES_HIGH int, UNORDERBYTES_AVG  int, UNORDERBYTES_LOW  int, DUPBYTES_HIGH int, DUPBYTES_AVG  int, DUPBYTES_LOW  int, PARTDUPBYTES_HIGH int, PARTDUPBYTES_AVG  int, PARTDUPBYTES_LOW  int, OUTSEGS_HIGH int, OUTSEGS_AVG  int, OUTSEGS_LOW  int, OUTDATASEGS_HIGH int, OUTDATASEGS_AVG  int, OUTDATASEGS_LOW  int, RETRANSSEGS_HIGH int, RETRANSSEGS_AVG  int, RETRANSSEGS_LOW  int, OUTBYTES_HIGH int, OUTBYTES_AVG  int, OUTBYTES_LOW  int, OUTDATABYTES_HIGH int, OUTDATABYTES_AVG  int, OUTDATABYTES_LOW  int, RETRANSBYTES_HIGH int, RETRANSBYTES_AVG  int, RETRANSBYTES_LOW  int, NUMPOINTS int, NUMSECS   int, PRIMARY KEY ("ITEMID", "FROMTIME") WITH HASH SIZE 10);"

sqli "create index SOLTCP_RT_N3 on SOLTCP_RT (FROMTIME,TOTIME);"

sqli "CREATE TABLE SOLTCP_BL (ITEMID   int,TIMESLOT int,AVTIVEOPEN_HIGH int,AVTIVEOPEN_AVG  int,AVTIVEOPEN_LOW  int,PASSIVEOPEN_HIGH int,PASSIVEOPEN_AVG  int,PASSIVEOPEN_LOW  int,CURRESTAB_HIGH int,CURRESTAB_AVG  int,CURRESTAB_LOW  int,LISTENDROP_HIGH int,LISTENDROP_AVG  int,LISTENDROP_LOW  int,HALFOPENDROP_HIGH int,HALFOPENDROP_AVG  int,HALFOPENDROP_LOW  int,LISTENDROPQ0_HIGH int,LISTENDROPQ0_AVG  int,LISTENDROPQ0_LOW  int,INSEGS_HIGH int,INSEGS_AVG  int,INSEGS_LOW  int,INORDERSEGS_HIGH int,INORDERSEGS_AVG  int,INORDERSEGS_LOW  int,UNORDERSEGS_HIGH int,UNORDERSEGS_AVG  int,UNORDERSEGS_LOW  int,DUPSEGS_HIGH int,DUPSEGS_AVG  int,DUPSEGS_LOW  int,PARTDUPSEGS_HIGH int,PARTDUPSEGS_AVG  int,PARTDUPSEGS_LOW  int,INBYTES_HIGH int,INBYTES_AVG  int,INBYTES_LOW  int,INORDERBYTES_HIGH int,INORDERBYTES_AVG  int,INORDERBYTES_LOW  int,UNORDERBYTES_HIGH int,UNORDERBYTES_AVG  int,UNORDERBYTES_LOW  int,DUPBYTES_HIGH int,DUPBYTES_AVG  int,DUPBYTES_LOW  int,PARTDUPBYTES_HIGH int,PARTDUPBYTES_AVG  int,PARTDUPBYTES_LOW  int,OUTSEGS_HIGH int,OUTSEGS_AVG  int,OUTSEGS_LOW  int,OUTDATASEGS_HIGH int,OUTDATASEGS_AVG  int,OUTDATASEGS_LOW  int,RETRANSSEGS_HIGH int,RETRANSSEGS_AVG  int,RETRANSSEGS_LOW  int,OUTBYTES_HIGH int,OUTBYTES_AVG  int,OUTBYTES_LOW  int,OUTDATABYTES_HIGH int,OUTDATABYTES_AVG  int,OUTDATABYTES_LOW  int,RETRANSBYTES_HIGH int,RETRANSBYTES_AVG  int,RETRANSBYTES_LOW  int,NUMPOINTS int,NUMWEEKS int,PRIMARY KEY ("ITEMID", "TIMESLOT") WITH HASH SIZE 10);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('SOLTCP_STATS', 'TIMERECORDED', 24);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('SOLTCP_RT', 'FROMTIME', 2160);"

) else (

REM Upgrade Installation for Monitor = Solaris TCP

REM sqli -c "
REM SELECT * FROM SYSCOLUMN A, SYSTABLE B WHERE A.TABLE_ID = B.TABLE_ID AND B.TABLE_NAME = 'TABLENAME' AND A.COLUMN_NAME = 'COLUMNNAME';
REM "
REM if %errorlevel% == 101 (

REM alter table add column statement here
echo Upgrade installation

REM )

)
