REM Check if its a Clean or an Upgrade Installation

sqli -c "SELECT * FROM SYSTABLE B WHERE B.TABLE_NAME = 'GENERICTCP_STATS';" > out.txt

if %errorlevel% == 101 (

REM Clean Installation for Monitor = GENERIC TCP
REM Schema & PruneCntl Statements for Monitor = GENERIC TCP ,moTypeId = 30101

echo Creating tables GENERICTCP_STATS, GENERICTCP_RT, GENERICTCP_BL
echo Creating Prune Control entries for GENERICTCP_STATS  AND  entries for GENERICTCP_RT
sqli "CREATE TABLE GENERICTCP_STATS (ITEMID int,TIMERECORDED int,TCPRTOMIN int,TCPRTOMAX int,TCPACTIVEOPENS int,TCPPASSIVEOPENS int,TCPATTEMPTFAILS int,TCPESTABRESETS int,TCPCURRESTAB int,TCPINSEGS int,TCPOUTSEGS int,TCPRETRANSSEGS int,TCPINERRS int,TCPOUTRSTS int,TCPFINWAIT int,TCPCLOSEWAIT int,PRIMARY KEY ("ITEMID", "TIMERECORDED") WITH HASH SIZE 10);"

REM If the STATS table creation failed exit with errorcode
if %errorlevel% == 1 (
    exit /b 117
)

sqli "create        index GENERICTCP_STATS_N3 on GENERICTCP_STATS (TIMERECORDED);"

sqli "CREATE TABLE GENERICTCP_RT (ITEMID int, FROMTIME int, TOTIME int, TCPRTOMIN_HIGH int, TCPRTOMIN_AVG  int, TCPRTOMIN_LOW  int, TCPRTOMAX_HIGH int, TCPRTOMAX_AVG  int, TCPRTOMAX_LOW  int, TCPACTIVEOPENS_HIGH int, TCPACTIVEOPENS_AVG  int, TCPACTIVEOPENS_LOW  int, TCPPASSIVEOPENS_HIGH int, TCPPASSIVEOPENS_AVG  int, TCPPASSIVEOPENS_LOW  int, TCPATTEMPTFAILS_HIGH int, TCPATTEMPTFAILS_AVG  int, TCPATTEMPTFAILS_LOW  int, TCPESTABRESETS_HIGH int, TCPESTABRESETS_AVG  int, TCPESTABRESETS_LOW  int, TCPCURRESTAB_HIGH int, TCPCURRESTAB_AVG  int, TCPCURRESTAB_LOW  int, TCPINSEGS_HIGH int, TCPINSEGS_AVG  int, TCPINSEGS_LOW  int, TCPOUTSEGS_HIGH int, TCPOUTSEGS_AVG  int, TCPOUTSEGS_LOW  int, TCPRETRANSSEGS_HIGH int, TCPRETRANSSEGS_AVG  int, TCPRETRANSSEGS_LOW  int, TCPINERRS_HIGH int, TCPINERRS_AVG  int, TCPINERRS_LOW  int, TCPOUTRSTS_HIGH int, TCPOUTRSTS_AVG  int, TCPOUTRSTS_LOW  int, TCPFINWAIT_HIGH int, TCPFINWAIT_AVG  int, TCPFINWAIT_LOW  int, TCPCLOSEWAIT_HIGH int, TCPCLOSEWAIT_AVG  int, TCPCLOSEWAIT_LOW  int, NUMPOINTS int, NUMSECS   int, PRIMARY KEY ("ITEMID", "FROMTIME") WITH HASH SIZE 10);"

sqli "create index GENERICTCP_RT_N3 on GENERICTCP_RT (FROMTIME,TOTIME);"

sqli "CREATE TABLE GENERICTCP_BL (ITEMID   int,TIMESLOT int,TCPRTOMIN_HIGH int,TCPRTOMIN_AVG  int,TCPRTOMIN_LOW  int,TCPRTOMAX_HIGH int,TCPRTOMAX_AVG  int,TCPRTOMAX_LOW  int,TCPACTIVEOPENS_HIGH int,TCPACTIVEOPENS_AVG  int,TCPACTIVEOPENS_LOW  int,TCPPASSIVEOPENS_HIGH int,TCPPASSIVEOPENS_AVG  int,TCPPASSIVEOPENS_LOW  int,TCPATTEMPTFAILS_HIGH int,TCPATTEMPTFAILS_AVG  int,TCPATTEMPTFAILS_LOW  int,TCPESTABRESETS_HIGH int,TCPESTABRESETS_AVG  int,TCPESTABRESETS_LOW  int,TCPCURRESTAB_HIGH int,TCPCURRESTAB_AVG  int,TCPCURRESTAB_LOW  int,TCPINSEGS_HIGH int,TCPINSEGS_AVG  int,TCPINSEGS_LOW  int,TCPOUTSEGS_HIGH int,TCPOUTSEGS_AVG  int,TCPOUTSEGS_LOW  int,TCPRETRANSSEGS_HIGH int,TCPRETRANSSEGS_AVG  int,TCPRETRANSSEGS_LOW  int,TCPINERRS_HIGH int,TCPINERRS_AVG  int,TCPINERRS_LOW  int,TCPOUTRSTS_HIGH int,TCPOUTRSTS_AVG  int,TCPOUTRSTS_LOW  int,TCPFINWAIT_HIGH int,TCPFINWAIT_AVG  int,TCPFINWAIT_LOW  int,TCPCLOSEWAIT_HIGH int,TCPCLOSEWAIT_AVG  int,TCPCLOSEWAIT_LOW  int,NUMPOINTS int,NUMWEEKS int,PRIMARY KEY ("ITEMID", "TIMESLOT") WITH HASH SIZE 10);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('GENERICTCP_STATS', 'TIMERECORDED', 24);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('GENERICTCP_RT', 'FROMTIME', 2160);"

) else (

REM Upgrade Installation for Monitor = GENERIC TCP

REM sqli -c "
REM SELECT * FROM SYSCOLUMN A, SYSTABLE B WHERE A.TABLE_ID = B.TABLE_ID AND B.TABLE_NAME = 'TABLENAME' AND A.COLUMN_NAME = 'COLUMNNAME';
REM "
REM if %errorlevel% == 101 (

REM alter table add column statement here
echo Upgrade installation

REM )

)
