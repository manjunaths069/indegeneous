REM Check if its a Clean or an Upgrade Installation

sqli -c "SELECT * FROM SYSTABLE B WHERE B.TABLE_NAME = 'AIXTCP_STATS';" > out.txt

if %errorlevel% == 101 (

REM Clean Installation for Monitor = AIX TCP 
REM Schema & PruneCntl Statements for Monitor = AIX TCP  ,moTypeId = 44501

echo Creating tables AIXTCP_STATS, AIXTCP_RT, AIXTCP_BL
echo Creating Prune Control entries for AIXTCP_STATS  AND  entries for AIXTCP_RT
sqli "CREATE TABLE AIXTCP_STATS (ITEMID int,TIMERECORDED int,CONNATTEMPT int,ACCEPTS int,CONNECTS int,CLOSED int,CONNDROPS int,REXMTTIMEO int,TIMEOUTDROP int,PERSISTTIMEO int,KEEPTIMEO int,KEEPPROBE int,KEEPDROPS int,SNDTOTAL int,SNDPACK int,SNDREXMITPACK int,SNDACKS int,SNDURG int,SNDCTRL int,SNDBYTE int,SNDREXMITBYTE int,RCVTOTAL int,RCVDUPPACK int,RCVOOPACK int,PRIMARY KEY ("ITEMID", "TIMERECORDED") WITH HASH SIZE 10);"

REM If the STATS table creation failed exit with errorcode
if %errorlevel% == 1 (
    exit /b 117
)

sqli "create        index AIXTCP_STATS_N3 on AIXTCP_STATS (TIMERECORDED);"

sqli "CREATE TABLE AIXTCP_RT (ITEMID int, FROMTIME int, TOTIME int, CONNATTEMPT_HIGH int, CONNATTEMPT_AVG  int, CONNATTEMPT_LOW  int, ACCEPTS_HIGH int, ACCEPTS_AVG  int, ACCEPTS_LOW  int, CONNECTS_HIGH int, CONNECTS_AVG  int, CONNECTS_LOW  int, CLOSED_HIGH int, CLOSED_AVG  int, CLOSED_LOW  int, CONNDROPS_HIGH int, CONNDROPS_AVG  int, CONNDROPS_LOW  int, REXMTTIMEO_HIGH int, REXMTTIMEO_AVG  int, REXMTTIMEO_LOW  int, TIMEOUTDROP_HIGH int, TIMEOUTDROP_AVG  int, TIMEOUTDROP_LOW  int, PERSISTTIMEO_HIGH int, PERSISTTIMEO_AVG  int, PERSISTTIMEO_LOW  int, KEEPTIMEO_HIGH int, KEEPTIMEO_AVG  int, KEEPTIMEO_LOW  int, KEEPPROBE_HIGH int, KEEPPROBE_AVG  int, KEEPPROBE_LOW  int, KEEPDROPS_HIGH int, KEEPDROPS_AVG  int, KEEPDROPS_LOW  int, SNDTOTAL_HIGH int, SNDTOTAL_AVG  int, SNDTOTAL_LOW  int, SNDPACK_HIGH int, SNDPACK_AVG  int, SNDPACK_LOW  int, SNDREXMITPACK_HIGH int, SNDREXMITPACK_AVG  int, SNDREXMITPACK_LOW  int, SNDACKS_HIGH int, SNDACKS_AVG  int, SNDACKS_LOW  int, SNDURG_HIGH int, SNDURG_AVG  int, SNDURG_LOW  int, SNDCTRL_HIGH int, SNDCTRL_AVG  int, SNDCTRL_LOW  int, SNDBYTE_HIGH int, SNDBYTE_AVG  int, SNDBYTE_LOW  int, SNDREXMITBYTE_HIGH int, SNDREXMITBYTE_AVG  int, SNDREXMITBYTE_LOW  int, RCVTOTAL_HIGH int, RCVTOTAL_AVG  int, RCVTOTAL_LOW  int, RCVDUPPACK_HIGH int, RCVDUPPACK_AVG  int, RCVDUPPACK_LOW  int, RCVOOPACK_HIGH int, RCVOOPACK_AVG  int, RCVOOPACK_LOW  int, NUMPOINTS int, NUMSECS   int, PRIMARY KEY ("ITEMID", "FROMTIME") WITH HASH SIZE 10);"

sqli "create index AIXTCP_RT_N3 on AIXTCP_RT (FROMTIME,TOTIME);"

sqli "CREATE TABLE AIXTCP_BL (ITEMID   int,TIMESLOT int,CONNATTEMPT_HIGH int,CONNATTEMPT_AVG  int,CONNATTEMPT_LOW  int,ACCEPTS_HIGH int,ACCEPTS_AVG  int,ACCEPTS_LOW  int,CONNECTS_HIGH int,CONNECTS_AVG  int,CONNECTS_LOW  int,CLOSED_HIGH int,CLOSED_AVG  int,CLOSED_LOW  int,CONNDROPS_HIGH int,CONNDROPS_AVG  int,CONNDROPS_LOW  int,REXMTTIMEO_HIGH int,REXMTTIMEO_AVG  int,REXMTTIMEO_LOW  int,TIMEOUTDROP_HIGH int,TIMEOUTDROP_AVG  int,TIMEOUTDROP_LOW  int,PERSISTTIMEO_HIGH int,PERSISTTIMEO_AVG  int,PERSISTTIMEO_LOW  int,KEEPTIMEO_HIGH int,KEEPTIMEO_AVG  int,KEEPTIMEO_LOW  int,KEEPPROBE_HIGH int,KEEPPROBE_AVG  int,KEEPPROBE_LOW  int,KEEPDROPS_HIGH int,KEEPDROPS_AVG  int,KEEPDROPS_LOW  int,SNDTOTAL_HIGH int,SNDTOTAL_AVG  int,SNDTOTAL_LOW  int,SNDPACK_HIGH int,SNDPACK_AVG  int,SNDPACK_LOW  int,SNDREXMITPACK_HIGH int,SNDREXMITPACK_AVG  int,SNDREXMITPACK_LOW  int,SNDACKS_HIGH int,SNDACKS_AVG  int,SNDACKS_LOW  int,SNDURG_HIGH int,SNDURG_AVG  int,SNDURG_LOW  int,SNDCTRL_HIGH int,SNDCTRL_AVG  int,SNDCTRL_LOW  int,SNDBYTE_HIGH int,SNDBYTE_AVG  int,SNDBYTE_LOW  int,SNDREXMITBYTE_HIGH int,SNDREXMITBYTE_AVG  int,SNDREXMITBYTE_LOW  int,RCVTOTAL_HIGH int,RCVTOTAL_AVG  int,RCVTOTAL_LOW  int,RCVDUPPACK_HIGH int,RCVDUPPACK_AVG  int,RCVDUPPACK_LOW  int,RCVOOPACK_HIGH int,RCVOOPACK_AVG  int,RCVOOPACK_LOW  int,NUMPOINTS int,NUMWEEKS int,PRIMARY KEY ("ITEMID", "TIMESLOT") WITH HASH SIZE 10);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('AIXTCP_STATS', 'TIMERECORDED', 24);"

sqli "INSERT INTO PRUNE_CNTL (TABLENAME, TIMECOLUMN, DELTAHOURS) VALUES ('AIXTCP_RT', 'FROMTIME', 2160);"

) else (

REM Upgrade Installation for Monitor = AIX TCP 

REM sqli -c "
REM SELECT * FROM SYSCOLUMN A, SYSTABLE B WHERE A.TABLE_ID = B.TABLE_ID AND B.TABLE_NAME = 'TABLENAME' AND A.COLUMN_NAME = 'COLUMNNAME';
REM "
REM if %errorlevel% == 101 (

REM alter table add column statement here
echo Upgrade installation

REM )

)
